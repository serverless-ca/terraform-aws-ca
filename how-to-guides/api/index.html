
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Terraform module for serverless Certificate Authority on AWS">
      
      
        <meta name="author" content="Paul Schwarzenberger">
      
      
        <link rel="canonical" href="https://serverlessca.com/how-to-guides/api/">
      
      
        <link rel="prev" href="../../security/">
      
      
        <link rel="next" href="../alb/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>API Gateway - Serverless CA on AWS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="API Gateway - Serverless CA on AWS" >
      
        <meta  property="og:description"  content="Terraform module for serverless Certificate Authority on AWS" >
      
        <meta  property="og:image"  content="https://serverlessca.com/assets/images/social/how-to-guides/api.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://serverlessca.com/how-to-guides/api/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="API Gateway - Serverless CA on AWS" >
      
        <meta  name="twitter:description"  content="Terraform module for serverless Certificate Authority on AWS" >
      
        <meta  name="twitter:image"  content="https://serverlessca.com/assets/images/social/how-to-guides/api.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-gateway-mtls-with-open-source-cloud-ca" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Serverless CA on AWS" class="md-header__button md-logo" aria-label="Serverless CA on AWS" data-md-component="logo">
      
  <img src="../../assets/images/cert-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Serverless CA on AWS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Gateway
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/serverless-ca/terraform-aws-ca" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    serverless-ca/terraform-aws-ca
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Serverless CA on AWS" class="md-nav__button md-logo" aria-label="Serverless CA on AWS" data-md-component="logo">
      
  <img src="../../assets/images/cert-logo.svg" alt="logo">

    </a>
    Serverless CA on AWS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/serverless-ca/terraform-aws-ca" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    serverless-ca/terraform-aws-ca
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../locations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CA Certificate locations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client certificates
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration options
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../revocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Revocation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-to guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            How-to guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Gateway
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Gateway
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-api-gateway-without-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy API Gateway without authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-api-gateway-without-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Test API Gateway without authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-open-source-serverless-ca" class="md-nav__link">
    <span class="md-ellipsis">
      Implement open-source serverless CA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-custom-domain-name-for-api-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Configure custom domain name for API Gateway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#map-api-custom-domain-name-to-api-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Map API custom domain name to API Gateway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-dns-entry-for-api-custom-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      Create DNS entry for API custom domain name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-default-api-endpoint-disabled" class="md-nav__link">
    <span class="md-ellipsis">
      Test default API endpoint disabled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-mutual-tls" class="md-nav__link">
    <span class="md-ellipsis">
      Test mutual TLS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-certificate-details-in-cloudwatch-logs" class="md-nav__link">
    <span class="md-ellipsis">
      View certificate details in CloudWatch logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certificate-revocation" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Revocation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application load balancer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IAM Roles Anywhere
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Revoking certificates
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terraform reference
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-gateway-mtls-with-open-source-cloud-ca">API Gateway mTLS with open-source cloud CA</h1>
<p>A step-by-step guide on implementing mTLS for Amazon API Gateway using our <a href="https://github.com/serverless-ca/terraform-aws-ca">open-source private cloud CA</a>, also published as a <a href="https://medium.com/@paulschwarzenberger/api-gateway-mtls-with-open-source-cloud-ca-3362438445de">blog post</a>.</p>
<p><img alt="Alt text" src="../../assets/images/api/api-ca-architecture.png?raw=true" title="API Gateway mTLS Architecture" /></p>
<h2 id="introduction">Introduction</h2>
<p>Programmatic communications between systems at different organisations usually use APIs, in most cases requiring client authentication before providing an API response. Client certificate authentication is an effective and scalable way of ensuring an API is only available to authorised systems.</p>
<p>Amazon API Gateway can be configured to require mutual Transport Layer Security (mTLS) using client certificate authentication. This requires a private Certificate Authority (CA) to issue client certificates to authorise systems to use the API service. We use our <a href="https://serverlessca.com">open-source serverless cloud CA</a>, a cost-effective, secure private CA which is straightforward to deploy as a Terraform module.</p>
<h2 id="deploy-api-gateway-without-authentication">Deploy API Gateway without authentication</h2>
<p>We’ll start by setting up an API Gateway open to the world. While we’d never actually do this for a confidential API, it’s useful to do so here for demonstration and learning purposes.</p>
<p>The following resources will be deployed to your AWS account:</p>
<ul>
<li>REST API Gateway</li>
<li>Lambda function</li>
<li>CloudWatch log groups</li>
<li>IAM policies and roles</li>
</ul>
<pre><code class="language-bash">git clone https://github.com/serverless-ca/api-gateway.git
</code></pre>
<ul>
<li>update <code>backend.tf</code> with your Terraform state S3 bucket details</li>
</ul>
<pre><code class="language-bash">cd api-gateway
terraform init
terraform plan
terraform apply
</code></pre>
<p>In the AWS console, select API Gateway, and view the deployed <code>cloud-app-api</code> REST API:</p>
<p><img alt="Alt text" src="../../assets/images/api/api-gateway-no-auth.png?raw=true" title="API Gateway REST API details" /></p>
<p>For the purposes of this how-to guide, we’ll use a Lambda function to provide the response to an API Gateway request.</p>
<p>In the AWS console, choose Lambda, then the <code>api-response</code> Lambda function:</p>
<p><img alt="Alt text" src="../../assets/images/api/lambda-function.png?raw=true" title="API Gateway REST API details" /></p>
<h2 id="test-api-gateway-without-authentication">Test API Gateway without authentication</h2>
<p>Select the API Gateway link from the Lambda console to view trigger details:</p>
<p><img alt="Alt text" src="../../assets/images/api/api-gateway-execution-endpoint.png?raw=true" title="API Endpoint details shown in Lambda console" /></p>
<p>Note that the HTTP method configured is POST, and that the API Gateway is set up with a publicly accessible execute API endpoint, and no authorisation.</p>
<p>Install <a href="https://www.postman.com/downloads">Postman</a> on your laptop. You’ll be encouraged to open an account with Postman, however you don’t need to for the purposes of this tutorial.</p>
<p>Copy the API Endpoint execute API from the AWS console Lambda trigger details above, choose the POST method, and test:</p>
<p><img alt="Alt text" src="../../assets/images/api/postman-no-auth.png?raw=true" title="API response with no authentication using Postman" /></p>
<p>You should see the message “successful response from API Gateway lambda function”.</p>
<h2 id="implement-open-source-serverless-ca">Implement open-source serverless CA</h2>
<p>If you haven’t already, set up the <a href="https://serverlessca.com">open-source serverless CA</a> as detailed in the <a href="../../getting-started/">Getting Started</a> guide. From a security perspective, a production CA should be in a dedicated AWS account, separate from the AWS account used for the REST API Gateway.</p>
<p>In this case, you’ll need to update the serverless CA Terraform configuration to allow the user or role logged in to the API Gateway AWS account to access the CA bundle in the external S3 bucket within your CA AWS account. For example, if you’re deploying via an IAM user, add in the optional variable below when calling the serverless CA Terraform module, and then deploy using Terraform.</p>
<pre><code class="language-bash">s3_aws_principals = [&quot;arn:aws:iam::&lt;API_GATEWAY_AWS_ACCOUNT_ID&gt;:user/&lt;YOUR_IAM_USER_NAME&gt;&quot;]
</code></pre>
<p>See the <a href="https://github.com/serverless-ca/cloud-ca">Cloud CA repository</a> as an example of how this can be done in practice.</p>
<p>The above configuration step isn’t required if you installed the API Gateway in the same AWS account as the serverless CA.</p>
<h2 id="configure-custom-domain-name-for-api-gateway">Configure custom domain name for API Gateway</h2>
<p>We’ll do the next steps manually, for the purposes of understanding and learning. However in a real environment, these should all be implemented using infrastructure-as-code such as Terraform.</p>
<p>From a domain which you own, choose an appropriate subdomain for the API gateway. Then create a TLS certificate using AWS Certificate Manager with DNS validation. This will be the API Gateway server certificate, which doesn’t need to be issued by the serverless private CA.</p>
<p><img alt="Alt text" src="../../assets/images/api/certificate-manager.png?raw=true" title="AWS Certificate Manager" /></p>
<ul>
<li>At API Gateway, Custom Domain Names, press Create</li>
<li>Enter the custom domain name you’ve chosen for your API Gateway</li>
<li>Slide mutual TLS authentication to on</li>
<li>Copy the S3 URI of the bundle PEM file in the CA External S3 bucket</li>
<li>Copy the Version ID of the bundle PEM file in the CA External S3 bucket</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/api-gw-truststore-config.png?raw=true" title="API Gateway mTLS configuration" /></p>
<ul>
<li>Choose the ACM certificate issued previously</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/api-gw-acm-config.png?raw=true" title="Selection of ACM certificate for API Gateway" /></p>
<ul>
<li>Press Create domain name</li>
</ul>
<h2 id="map-api-custom-domain-name-to-api-gateway">Map API custom domain name to API Gateway</h2>
<p>The newly created API custom domain name must now be mapped to the API Gateway created earlier.</p>
<ul>
<li>At your newly created API custom domain name, select API mappings</li>
<li>Press Configure API mappings, Add new mappings</li>
<li>Select the already configured API Gateway and environment</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/default-api-endpoint-warning.png?raw=true" title="API Gateway warning of potential mTLS bypass" /></p>
<ul>
<li>You’ll see a warning that the default execute API endpoint must be disabled to prevent bypass of mutual TLS</li>
<li>Select the <code>cloud-app-api</code> API Gateway, API Settings, Edit</li>
<li>Change the default endpoint to Inactive</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/default-api-endpoint-inactive.png?raw=true" title="API Gateway settings with default execute endpoint disabled" /></p>
<ul>
<li>Press Save changes</li>
<li>Return to the <code>cloud-app-api</code> resources screen</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/deploy-api.png?raw=true" title="Deploy API" /></p>
<ul>
<li>Press Deploy API</li>
<li>Choose the dev stage and press Deploy</li>
<li>Return to the Add new mapping screen which should no longer show the warning</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/add-new-mapping.png?raw=true" title="Warning no longer shown" /></p>
<ul>
<li>Press Save</li>
<li>View the custom domain name, now configured for mTLS</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/custom-domain-name-configured.png?raw=true" title="API Gateway custom domain mapping" /></p>
<h2 id="create-dns-entry-for-api-custom-domain-name">Create DNS entry for API custom domain name</h2>
<p>We need to create a public DNS record to the new API custom domain name.</p>
<ul>
<li>within Route53 for your hosted zone, create a DNS record for the custom domain name</li>
<li>the CNAME value should be the API endpoint as listed in the custom domain name configuration</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/dns-record.png?raw=true" title="Route53 entry for API Gateway custom domain" /></p>
<h2 id="test-default-api-endpoint-disabled">Test default API endpoint disabled</h2>
<p>First, let’s confirm that the default execute API endpoint is disabled.</p>
<ul>
<li>Open Postman</li>
<li>Repeat the API call made earlier</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/default-endpoint-failure.png?raw=true" title="Test using Postman without a certificate results in a 403 response" /></p>
<ul>
<li>You should see a <code>"Forbidden"</code> message</li>
<li>If you still get the previous response, check you’ve deployed the API</li>
</ul>
<h2 id="test-mutual-tls">Test mutual TLS</h2>
<ul>
<li>Issue a client certificate to your laptop using the utils\client-cert.py script as described in the serverless CA <a href="../../getting-started/">Getting Started</a> guide</li>
<li>this will create the following files in your home directory:</li>
</ul>
<pre><code class="language-bash">certs/client-key.pem
certs/client-cert.pem
certs/client-cert.crt
certs/client-cert-key.pem
</code></pre>
<ul>
<li>open Postman</li>
<li>select Settings, Certificates, Client Certificates, Add Certificate</li>
<li>Enter the custom domain name</li>
<li>navigate to the <code>client-cert.crt</code> and <code>client-key.pem</code> files</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/add-certificate.png?raw=true" title="Configuring Postman with client certificates" /></p>
<ul>
<li>press Add</li>
<li>close Settings</li>
<li>Send a POST request to your custom domain name adding the <code>/api</code> path</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/client-auth-success.png?raw=true" title="Successful response using Postman with client certificate" /></p>
<ul>
<li>The success message should be returned indicating a successful response</li>
</ul>
<h2 id="view-certificate-details-in-cloudwatch-logs">View certificate details in CloudWatch logs</h2>
<p>Details of the connection can be viewed within CloudWatch logs</p>
<ul>
<li>view the api-gateway-access CloudWatch log</li>
</ul>
<p><img alt="Alt text" src="../../assets/images/api/cloudwatch-logs.png?raw=true" title="API Gateway access logs shows certificate details" /></p>
<ul>
<li>details of your certificate connection can be viewed</li>
</ul>
<p>👏 🎉 🎊 Congratulations, you’ve set up and tested API Gateway mTLS with the open-source serverless CA 🎆 🌟 🎇</p>
<h2 id="certificate-revocation">Certificate Revocation</h2>
<p>Amazon API Gateway mTLS doesn’t by default support Certificate Revocation List (CRL) checking.</p>
<p>This can be implemented using an API Gateway Lambda authorizer, checking against the latest CRL issued by the serverless CA. The Lambda authorizer may also perform additional checks to require the client certificate to have particular certificate distinguished name fields such as a specific Organization Unit (OU).</p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../security/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Security">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Security
              </div>
            </div>
          </a>
        
        
          
          <a href="../alb/" class="md-footer__link md-footer__link--next" aria-label="Next: Application load balancer">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Application load balancer
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/serverless-ca/terraform-aws-ca" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/paulschwarzen" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "pymdownx.snippets", "navigation.footer", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>